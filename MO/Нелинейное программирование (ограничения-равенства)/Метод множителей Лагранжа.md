
> [!INFO] **Метод множителей Лагранжа** - это стандартный способ получения необходимых условий экстремума для задач с ограничениями-равенствами.

Необходимые условия (7) (из [[Преобразование задачи (НЛП)|предыдущего раздела]]) удобнее получать, составив следующую функцию:
$$F(\bar{x}, \bar{\lambda}) = Q(\bar{x}) + \sum_{i=1}^m \lambda_i [\phi_i^* - \phi_i(\bar{x})]. \quad (8)$$
Эту функцию называют **функцией Лагранжа**, а $\lambda_i$ - **множителями Лагранжа**.

Далее мы приравниваем её частные производные к нулю по всем $x_j$ (для $j=1,\dots,n$) и по всем $\lambda_i$ (для $i=1,\dots,m$):
$$\begin{cases} \frac{\partial F}{\partial x_j} = \frac{\partial Q(\bar{x})}{\partial x_j} - \sum_{i=1}^m \lambda_i \frac{\partial \phi_i(\bar{x})}{\partial x_j} = 0, & j = 1,\dots,n \\ \frac{\partial F}{\partial \lambda_i} = \phi_i^* - \phi_i(\bar{x}) = 0, & i = 1,\dots,m \end{cases}$$
> [!INFO] Построение необходимых условий таким способом называют **методом множителей Лагранжа**.

---

## Общий случай с $n$ переменными и $m < n$ ограничениями

Рассмотрим общий случай с $n$ переменными и $m < n$ ограничениями.
Пусть в точке $\bar{x}^0$ функция $Q(\bar{x})$ имеет относительный максимум или минимум для $\bar{x} \in D$. Далее предположим, что в точке $\bar{x}^0$ ранг матрицы $\Phi = \left[\frac{\partial \phi_i}{\partial x_j}\right]_{m \times n}$ равен $m$.
Для простоты будем считать, что матрица $J_{\bar{x}^0}(1,2,\dots,m)$ (якобиан по первым $m$ столбцам) является неособенной (её определитель не равен нулю).

Тогда по [[Преобразование задачи (НЛП)#Условия существования неявных функций (Теорема о неявных функциях)|теореме о неявных функциях]] существует $\varepsilon$-окрестность точки $\hat{\bar{x}}^0 = (x_{m+1}^0, \dots, x_n^0)^T$ такая, что для каждой точки $\hat{\bar{x}}$ из этой $\varepsilon$-окрестности можно разрешить уравнения $\phi_i(\bar{x}) = \phi_i^*, \quad i = 1,\dots,m$, относительно $x_1, x_2, \dots, x_m$.
То есть, $x_i = \Psi_i(\hat{\bar{x}})$, $i = 1,\dots,m$. Причем функции $\Psi_i$ непрерывно дифференцируемы в окрестности точки $\hat{\bar{x}}^0$ и $x_i^0 = \Psi_i(\hat{\bar{x}}^0)$.

### Преобразование к безусловной задаче

Функция $h(\hat{\bar{x}}) = Q(\Psi_1(\hat{\bar{x}}), \Psi_2(\hat{\bar{x}}), \dots, \Psi_m(\hat{\bar{x}}), \hat{\bar{x}})$ имеет в точке $\hat{\bar{x}}^0$ безусловный относительный максимум или минимум.
Поэтому:
$$\frac{\partial h(\hat{\bar{x}}^0)}{\partial x_j} = 0, \quad j = (m+1),\dots,n. \quad (9)$$
По правилу дифференцирования сложной функции:
$$\frac{\partial h}{\partial x_j} = \sum_{k=1}^m \frac{\partial Q}{\partial x_k} \frac{\partial \Psi_k}{\partial x_j} + \frac{\partial Q}{\partial x_j}, \quad j = (m+1),\dots,n. \quad (10)$$
По теореме о неявных функциях производные $\frac{\partial \Psi_i}{\partial x_j}, \quad i = 1,2,\dots,m$, для каждого $j$ представляют собой решение системы уравнений:
$$\sum_{k=1}^m \frac{\partial \phi_i}{\partial x_k} \frac{\partial \Psi_k}{\partial x_j} = -\frac{\partial \phi_i}{\partial x_j}, \quad i=1,2,\dots,m. \quad (11)$$

### Введение множителей Лагранжа $\lambda_i$

Рассмотрим набор чисел $\lambda_i, i = 1,2,\dots,m$, являющийся решением системы $m$ уравнений:
$$\sum_{i=1}^m \lambda_i \frac{\partial \phi_i(\bar{x}^0)}{\partial x_k} = \frac{\partial Q(\bar{x}^0)}{\partial x_k}, \quad k = 1,2,\dots,m. \quad (12)$$
Решение этой системы существует и единственно, так как матрица коэффициентов $J_{\bar{x}^0}(1,2,\dots,m)$ по предположению неособенная.

Умножим $i$-е уравнение из (11) на $\lambda_i$ и просуммируем по $i$. Для каждого $j, j = m+1,\dots,n$, получаем:
$$\sum_{i=1}^m \lambda_i \sum_{k=1}^m \frac{\partial \phi_i}{\partial x_k} \frac{\partial \Psi_k}{\partial x_j} = -\sum_{i=1}^m \lambda_i \frac{\partial \phi_i}{\partial x_j}. \quad (13)$$
Из (9) и (10) следует:
$$\sum_{k=1}^m \frac{\partial Q(\bar{x}^0)}{\partial x_k} \frac{\partial \Psi_k(\hat{\bar{x}}^0)}{\partial x_j} + \frac{\partial Q(\bar{x}^0)}{\partial x_j} = 0, \quad j = m+1,\dots,n. \quad (14)$$

### Конечная система условий (стационарность Лагранжиана)

Вычислим (13) в точке $\bar{x}^0$ и вычтем из (14), получим (после некоторых преобразований):
$$\frac{\partial Q(\bar{x}^0)}{\partial x_j} - \sum_{i=1}^m \lambda_i \frac{\partial \phi_i(\bar{x}^0)}{\partial x_j} = 0, \quad j = m+1,\dots,n. \quad (16)$$

Объединив (16) с (12) и ограничениями, получим, что точка $\bar{x}^0$, в которой достигается относительный максимум или минимум, должна удовлетворять следующей системе из $n+m$ уравнений:
$$\begin{cases} \frac{\partial Q(\bar{x}^0)}{\partial x_j} - \sum_{i=1}^m \lambda_i \frac{\partial \phi_i(\bar{x}^0)}{\partial x_j} = 0, & j = 1,\dots,n \\ \phi_i(\bar{x}^0) = \phi_i^*, & i = 1,\dots,m \end{cases} \quad (17)$$
Каждая точка $\bar{x}^0$, в которой достигается относительный максимум или минимум при $\bar{x} \in D$, будет являться решением системы (17).

---

## Геометрическая иллюстрация (для понимания)

(Представь 3D график, где есть поверхность $Q(\bar{x})$ и кривая $\phi(\bar{x})=\phi^*$. На кривой будут точки, где $Q(\bar{x})$ имеет локальный максимум/минимум. В этих точках градиент $Q(\bar{x})$ параллелен градиенту $\phi(\bar{x})$ (если одно ограничение) или лежит в плоскости, натянутой на градиенты ограничений (если несколько ограничений). Это и есть смысл множителей Лагранжа).